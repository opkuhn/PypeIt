
Version 1.14.1dev
=================

Dependency Changes
------------------

- Removes use of deprecated ``pkg_resources``.
- Require version ``>=1.12`` for ``specutils``.

Functionality/Performance Improvements and Additions
----------------------------------------------------

- Started the development of instrument-specific scattered light removal. In this
  release, we only model KCWI/KCRM scattered light.
- Turned on usage of the use_2dmodel_mask parameter for echelle spectrographs
- Added support for Keck/KCRM RL data reduction.
- Allow one to turn off reinit of reduce_bpm in global_skysub and made this
  the default for the final pass
- Allow pypeit Spectrum1D loaders to circumvent the requirement that reduced
  spectrum have monotonically increasing wavelength data.  Non-monotonic
  wavelength data usually indicate a problem with the data reduction, but this
  at least lets users ingest the spectrum.
- Add a sensible error message to the pypeit Spectrum1D loaders in the event a
  user inadvertently tries to use Spectrum1D instead of SpectrumList for a
  ``spec1d`` file.

Instrument-specific Updates
---------------------------

- Keck/KCWI and Keck/KCRM: Turned on polynomial correction for sky subtraction.
- We now support the reduction of VLT/FORS2 data taken in MOS mode.
- Fixed fluxing file format in the ``Keck-DEIMOS HOWTO`` documentation.

Script Changes
--------------

- When making datacubes, the user can select a separate frame to use for the sky subtraction.
  In this case, it is the processed data that will be used for sky subtraction (akin to nodding).

Datamodel Changes
-----------------

- A wavelength array is now stored for DataCube()

Under-the-hood Improvements
---------------------------

- The CoAdd3D code has been refactored into a series of core modules and PypeIt-specific routines.

Bug Fixes
---------

- Fixed bug associated with finding more than one file with the same name (but
  presumably different extensions).
- Fixed differential atmospheric refraction (DAR) correction bug. This bug affected
  datacubes combined using CoAdd3D(). Previously, the DAR was being computed, applied,
  and then later overwritten. The new routine is faster and more accurate.
- Fixed a bug associated with an incorrect date for the transition to the Mark4
  detector for Keck/LRIS RED.
- Fixed a bug with the ``pypeit_identify`` script when using echelle data. Previously,
  the sigdetect parameter was a list of all orders, instead of a single value.


